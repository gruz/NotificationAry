(function($){'use strict';$.fieldUsers=function(container,options){this.options=$.extend({},$.fieldUsers.defaults,options);this.$container=$(container);this.$modal=this.$container.find(this.options.modal);this.$modalBody=this.$modal.children('.modal-body');this.$input=this.$container.find(this.options.input);this.$buttonSelect=this.$container.find(this.options.buttonSelect);this.$buttonSelect.on('click',this.modalOpen.bind(this));this.$modal.on('hide',this.removeIframe.bind(this));var onchangeStr=this.$input.attr('data-onchange'),onchangeCallback;if(onchangeStr){onchangeCallback=new Function(onchangeStr);this.$input.on('change',onchangeCallback.bind(this.$input))}};$.fieldUsers.prototype.modalOpen=function(){var $iframe=$('<iframe>',{name:'field-users-modal',src:this.options.url.replace('{field-users-id}',this.$input.attr('id')),width:this.options.modalWidth,height:this.options.modalHeight});this.$modalBody.append($iframe);this.$modal.modal('show');$('body').addClass('modal-open');var self=this;$iframe.load(function(){var content=$(this).contents();var selectOptions=$(self.$input).find('option:selected');var appendText='<span class="icon-publish"></span>';$(selectOptions).each(function(){var $elem=$(content).find('a[data-user-value="'+$(this).val()+'"]');$elem.append(appendText);$elem.addClass('disabled');$elem.removeClass('button-select');$elem.unbind("click")});content.on('click','.button-select',function(){if(self.$input.is("input")){self.setValue($(this).data('user-value'),$(this).data('user-name'))}else{var username_element=$(this).parent().parent().find('td')[1];var username=$(username_element).text();self.setValue($(this).data('user-value'),username)}
var $elem=$(this);$elem.append(appendText);$elem.addClass('disabled');$elem.removeClass('button-select');$elem.unbind("click");$('body').removeClass('modal-open')})})};$.fieldUsers.prototype.modalClose=function(){this.$modal.modal('hide');this.$modalBody.empty();$('body').removeClass('modal-open')};$.fieldUsers.prototype.removeIframe=function(){this.$modalBody.empty();$('body').removeClass('modal-open')};$.fieldUsers.prototype.setValue=function(value,name){var current_value=this.$input.val();if(current_value){var res_value=current_value+','+value}else{var res_value=value}
if(this.$input.is("input")){this.$input.val(res_value).trigger('change')}else{this.$input.find('option[value="'+value+'"]').remove();this.$input.append('<option selected="selected" value="'+value+'">'+name+'</option>');this.$input.trigger('change');this.$input.trigger("liszt:updated")}};$.fieldUsers.defaults={buttonSelect:'.button-select',input:'.field-users-input',inputName:'.field-users-input-name',modal:'.modal',url:'index.php?option=com_users&view=users&layout=modal&tmpl=component',modalWidth:'100%',modalHeight:'300px'};$.fn.fieldUsers=function(options){return this.each(function(){var $el=$(this),instance=$el.data('fieldUsers');if(!instance){var options=options||{},data=$el.data();for(var p in data){if(data.hasOwnProperty(p)){options[p]=data[p]}}
instance=new $.fieldUsers(this,options);$el.data('fieldUsers',instance)}})};$(document).ready(function(){$('.field-users-wrapper').fieldUsers()})})(jQuery);function jSelectUsers(element){var $el=jQuery(element),value=$el.data('users-value'),name=$el.data('users-name'),fieldId=$el.data('users-field'),$inputValue=jQuery('#'+fieldId+'_id'),$inputName=jQuery('#'+fieldId);if(!$inputValue.length){return}
$inputValue.val(value).trigger('change');$inputName.val(name||value).trigger('change');var onchangeStr=$inputValue.attr('data-onchange'),onchangeCallback;if(onchangeStr){onchangeCallback=new Function(onchangeStr);onchangeCallback.call($inputValue[0])}
jModalClose()}